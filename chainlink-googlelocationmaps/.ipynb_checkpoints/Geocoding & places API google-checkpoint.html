{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "c0e7dba1",
   "metadata": {},
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "a1250697",
   "metadata": {},
   "outputs": [],
   "source": [
    "api_key = \"AIzaSyAtsBqxiFylSeRKayVaLcQAak92ufygQdM\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 53,
   "id": "b2b5c738",
   "metadata": {},
   "outputs": [
    {
     "ename": "IndentationError",
     "evalue": "unindent does not match any outer indentation level (<tokenize>, line 7)",
     "output_type": "error",
     "traceback": [
      "\u001b[0;36m  File \u001b[0;32m\"<tokenize>\"\u001b[0;36m, line \u001b[0;32m7\u001b[0m\n\u001b[0;31m    //Clients:\u001b[0m\n\u001b[0m    ^\u001b[0m\n\u001b[0;31mIndentationError\u001b[0m\u001b[0;31m:\u001b[0m unindent does not match any outer indentation level\n"
     ]
    }
   ],
   "source": [
    "Steps:\n",
    "    1.signup for goolge cloud\n",
    "    2.create a project inside google cloud\n",
    "    3.Activate our API services->Geocoding API & places API\n",
    "    4.get API Key & Restrict\n",
    "    \n",
    " //Clients:\n",
    "    1. Google maps API docs\n",
    "    2. Geocoding API\n",
    "    3. Places API\n",
    "    \n",
    "    \n",
    "   Sample = 'https://maps.googleapis.com/maps/api/geocode/json?address=1600+Amphitheatre+Parkway,+Mountain+View,+CA&key=AIzaSyAtsBqxiFylSeRKayVaLcQAak92ufygQdM' \n",
    "    \n",
    "    "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 54,
   "id": "75a9fc62",
   "metadata": {},
   "outputs": [],
   "source": [
    "import requests\n",
    "from urllib.parse import urlencode\n",
    "api_key = \"AIzaSyAtsBqxiFylSeRKayVaLcQAak92ufygQdM\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "id": "6b817114",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "https://maps.googleapis.com/maps/api/geocode/json?address=No29+Ferndene+Groove%2C+Newcastle&key=AIzaSyAtsBqxiFylSeRKayVaLcQAak92ufygQdM\n"
     ]
    }
   ],
   "source": [
    "data_type = 'json'\n",
    "endpoint = f\"https://maps.googleapis.com/maps/api/geocode/{data_type}\"\n",
    "params = {\"address\": \"No 29 Ferndene groove, Newcastle\",\"key\": api_key}\n",
    "url_params = urlencode(params)\n",
    "\n",
    "url = f\"{endpoint}?{url_params}\"\n",
    "print(url)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 78,
   "id": "37ab3154",
   "metadata": {},
   "outputs": [],
   "source": [
    "def extract_lat_lng(address_or_postalcode, data_type = 'json'):\n",
    "    endpoint = f\"https://maps.googleapis.com/maps/api/geocode/{data_type}\"\n",
    "    params = {\"address\": address_or_postalcode, \"key\" : api_key}\n",
    "    url_params = urlencode(params)\n",
    "    url = f\"{endpoint}?{url_params}\"\n",
    "    r = requests.get(url)\n",
    "    if r.status_code not in range(200, 299):\n",
    "        return {}\n",
    "    latlng = {}\n",
    "    try:\n",
    "        latlng = r.json()['results'][0]['geometry']['location']\n",
    "    except:\n",
    "        pass\n",
    "    return latlng.get(\"lat\"), latlng.get(\"lng\")\n",
    "    \n",
    "    "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 65,
   "id": "fe996cd2",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<function dict.keys>"
      ]
     },
     "execution_count": 65,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "extract_lat_lng( \"No 29 Ferndene Groove, Newcastle\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 60,
   "id": "752c1d09",
   "metadata": {},
   "outputs": [],
   "source": [
    "from urllib.parse import urlparse, parse_qsl\n",
    "to_parse = \"https://maps.googleapis.com/maps/api/geocode/json?address=No29+Ferndene+Groove%2C+Newcastle&key=AIzaSyAtsBqxiFylSeRKayVaLcQAak92ufygQdM\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 33,
   "id": "cb2ec0be",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "ParseResult(scheme='https', netloc='maps.googleapis.com', path='/maps/api/geocode/json', params='', query='address=No29+Ferndene+Groove%2C+Newcastle&key=AIzaSyAtsBqxiFylSeRKayVaLcQAak92ufygQdM', fragment='')"
      ]
     },
     "execution_count": 33,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "urlparse(to_parse)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 44,
   "id": "d42fdb96",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'address=No29+Ferndene+Groove%2C+Newcastle&key=AIzaSyAtsBqxiFylSeRKayVaLcQAak92ufygQdM'"
      ]
     },
     "execution_count": 44,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "parsed_url = urlparse(to_parse)\n",
    "query_string = parsed_url.query\n",
    "query_string"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "id": "f3c3eda4",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[('address', 'No29 Ferndene Groove, Newcastle'), ('key', 'AIzaSyAtsBqxiFylSeRKayVaLcQAak92ufygQdM')]\n"
     ]
    }
   ],
   "source": [
    "query_tuple = parse_qsl(query_string)\n",
    "print(query_tuple)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 46,
   "id": "dcde69b1",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'address': 'No29 Ferndene Groove, Newcastle',\n",
       " 'key': 'AIzaSyAtsBqxiFylSeRKayVaLcQAak92ufygQdM'}"
      ]
     },
     "execution_count": 46,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "query_dict = dict(query_tuple)\n",
    "query_dict"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 75,
   "id": "bb7fd5da",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "https://maps.googleapis.com/maps/api/geocode/json\n"
     ]
    }
   ],
   "source": [
    "endpoint = f\"{parsed_url.scheme}://{parsed_url.netloc}{parsed_url.path}\"\n",
    "print(endpoint)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "e681c54b",
   "metadata": {},
   "outputs": [],
   "source": [
    "Places API"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 93,
   "id": "70e56f10",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "https://maps.googleapis.com/maps/api/place/findplacefromtext/json?key=AIzaSyAtsBqxiFylSeRKayVaLcQAak92ufygQdM&input=South+Indian+Food&inputtype=textquery&fields=formatted_address%2Cname%2Cgeometry%2Cpermanently_closed&locationbias=point%3A37.42230960000001%2C-122.0846244\n"
     ]
    }
   ],
   "source": [
    "lat, lng = 37.42230960000001, -122.0846244\n",
    "base_endpoint_places = \"https://maps.googleapis.com/maps/api/place/findplacefromtext/json\"\n",
    "params = {\n",
    "    \"key\": api_key,\n",
    "    \"input\": \"South Indian Food\",\n",
    "    \"inputtype\": \"textquery\",\n",
    "    \"fields\": \"formatted_address,name,geometry,permanently_closed\"\n",
    "    \n",
    "}\n",
    "locationbias = f\"point:{lat},{lng}\"\n",
    "use_cirular = True\n",
    "if use_cirular:\n",
    "    radius = 5000\n",
    "    locationbias = f\"circle:{radius}@{lat},{lng}\"\n",
    "\n",
    "params['locationbias'] = locationbias    \n",
    "\n",
    "params_encoded = urlencode(params)\n",
    "\n",
    "places_endpoint = f\"{base_endpoint_places}?{params_encoded}\"\n",
    "print(places_endpoint)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 95,
   "id": "cfd9ad3e",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "200\n"
     ]
    }
   ],
   "source": [
    "r = requests.get(places_endpoint)\n",
    "print(r.status_code)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 97,
   "id": "72018012",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'candidates': [{'formatted_address': '80 W El Camino Real, Mountain View, CA 94040, United States',\n",
       "   'geometry': {'location': {'lat': 37.3818546, 'lng': -122.0748781},\n",
       "    'viewport': {'northeast': {'lat': 37.38308457989272,\n",
       "      'lng': -122.0735867201072},\n",
       "     'southwest': {'lat': 37.38038492010728, 'lng': -122.0762863798927}}},\n",
       "   'name': 'Annachikadai'}],\n",
       " 'status': 'OK'}"
      ]
     },
     "execution_count": 97,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "r.json()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 100,
   "id": "951a0000",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'html_attributions': [],\n",
       " 'results': [{'business_status': 'OPERATIONAL',\n",
       "   'geometry': {'location': {'lat': 37.4140761, 'lng': -122.0932},\n",
       "    'viewport': {'northeast': {'lat': 37.41550817989272,\n",
       "      'lng': -122.0918528201072},\n",
       "     'southwest': {'lat': 37.41280852010728, 'lng': -122.0945524798927}}},\n",
       "   'icon': 'https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/restaurant-71.png',\n",
       "   'icon_background_color': '#FF9E67',\n",
       "   'icon_mask_base_uri': 'https://maps.gstatic.com/mapfiles/place_api/icons/v2/restaurant_pinlet',\n",
       "   'name': 'INdGO Indian Restaurant',\n",
       "   'opening_hours': {'open_now': False},\n",
       "   'photos': [{'height': 682,\n",
       "     'html_attributions': ['<a href=\"https://maps.google.com/maps/contrib/109123094021543443616\">A Google User</a>'],\n",
       "     'photo_reference': 'Aap_uEBRf03vVwJYZ2e136TjJ1r7-yKNx_mOmCE7gPnm2fnoFGyHz_03gC2BUn9PsBZL9jknJ_ZSAduL5_5fkgLpbktCwiKWMNXv58_ReNDct5RTzdFNM7-Mc9V4a77g13VhEg25U2UeKhlW46UwpCmRFoQz3SHJId18SIXKNtFPMDgxQ2z4',\n",
       "     'width': 512}],\n",
       "   'place_id': 'ChIJETHw0F-7j4AR85V_I6OobCI',\n",
       "   'plus_code': {'compound_code': 'CW74+JP Mountain View, California, USA',\n",
       "    'global_code': '849VCW74+JP'},\n",
       "   'price_level': 2,\n",
       "   'rating': 4.6,\n",
       "   'reference': 'ChIJETHw0F-7j4AR85V_I6OobCI',\n",
       "   'scope': 'GOOGLE',\n",
       "   'types': ['grocery_or_supermarket',\n",
       "    'meal_takeaway',\n",
       "    'restaurant',\n",
       "    'food',\n",
       "    'point_of_interest',\n",
       "    'store',\n",
       "    'establishment'],\n",
       "   'user_ratings_total': 67,\n",
       "   'vicinity': '2105 Old Middlefield Way, Mountain View'}],\n",
       " 'status': 'OK'}"
      ]
     },
     "execution_count": 100,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "places_endpoint_2 = \"https://maps.googleapis.com/maps/api/place/nearbysearch/json\"\n",
    "params_2 = {\n",
    "    \"key\": api_key,\n",
    "    \"location\": f\" {lat},{lng}\",\n",
    "    \"radius\": 1500,\n",
    "    \"keyword\": \"South Indian Food\"\n",
    "    \n",
    "}\n",
    "params_2_encoded = urlencode(params_2)\n",
    "places_url = f\"{places_endpoint_2}?{params_2_encoded}\"\n",
    "\n",
    "r2 = requests.get(places_url)\n",
    "r2.json()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 102,
   "id": "8aabe7e1",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'html_attributions': [],\n",
       " 'result': {'formatted_phone_number': '(02) 9374 4000',\n",
       "  'name': 'Google Workplace 6',\n",
       "  'rating': 4.1},\n",
       " 'status': 'OK'}"
      ]
     },
     "execution_count": 102,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#detail_look up\n",
    "\n",
    "place_id = \"ChIJN1t_tDeuEmsRUsoyG83frY4\"\n",
    "detail_base_endpoint = \"https://maps.googleapis.com/maps/api/place/details/json\"\n",
    "detail_params = {\n",
    "    \"place_id\": f\"{place_id}\",\n",
    "    \"fields\" : \"name,rating,formatted_phone_number,formatted_address\",\n",
    "    \"key\": api_key\n",
    "}\n",
    "detail_params_encoded = urlencode(detail_params)\n",
    "detail_url = f\"{detail_base_endpoint}?{detail_params_encoded}\"\n",
    "r = requests.get(detail_url)\n",
    "r.json()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "4e65fa8b",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "7a0c8ea1",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
